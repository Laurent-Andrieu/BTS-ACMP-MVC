<!--
(c) 2019-2020 Flore Philippe
 Solid Gauge
 -->
<!DOCTYPE html>
<!-- INSTANT -->
<aside id="instant">
	<figure class="highcharts-figure">
		<div id="carbon" class="chart-container"></div>
	</figure>
	<figure class="highcharts-figure">
		<div id="ozone" class="chart-container"></div>
	</figure>
	<figure class="highcharts-figure">
		<div id="particules" class="chart-container"></div>
	</figure>
	<script type="text/javascript">
		var request = xhr.getLastValues();
		var carbon = Highcharts.chart('carbon', Highcharts.merge(gaugeOptions, {
			yAxis: {
				min: 0,
				max: 1000,
				title: {
					text: request[2].name
				}
			},

			credits: {
				enabled: false
			},

			series: [{
				name: request[2].name,
				data: [parseFloat(request[2].value)],
				dataLabels: {
					format:
						'<div style="text-align:center">' +
						'<span style="font-size:30px">{y}</span><br/>' +
						`<span style="font-size:12px;opacity:0.4">${request[2].unit}</span>` +
						'</div>'
				},

				tooltip: {
					valueSuffix: request[2].unit
				}
			}]
		}));

		// Ozone
		var ozone = Highcharts.chart('ozone', Highcharts.merge(gaugeOptions, {
			yAxis: {
				min: 0,
				max: 200,
				title: {
					text: request[1].name
				}
			},

			credits: {
				enabled: false
			},

			series: [{
				name: request[1].name,
				data: [parseFloat(request[1].value)],
				dataLabels: {
					format:
						'<div style="text-align:center">' +
						'<span style="font-size:25px">{y}</span><br/>' +
						`<span style="font-size:12px;opacity:0.4">${request[1].unit}</span>` +
						'</div>'
				},
				tooltip: {
					valueSuffix: request[1].unit
				}
			}]
		}));

		// Particules Fines
		var particules = Highcharts.chart('particules', Highcharts.merge(gaugeOptions, {
			yAxis: {
				min: 0,
				max: 200,
				title: {
					text: request[0].name
				}
			},

			credits: {
				enabled: false
			},

			series: [{
				name: request[0].name,
				data: [parseFloat(request[0].value)],
				dataLabels: {
					format:
						'<div style="text-align:center">' +
						'<span style="font-size:25px">{y}</span><br/>' +
						`<span style="font-size:12px;opacity:0.4">${request[0].unit}</span>` +
						'</div>'
				},
				tooltip: {
					valueSuffix: request[0].unit
				}
			}]
		}));

		if(gaugeInterval)
			clearInterval(gaugeInterval);

		var gaugeInterval = setInterval(() => {
			if(carbon)
				xhr.getLastValueFor(carbon.series[0].points[0], 'CO2');

			if(ozone)
				xhr.getLastValueFor(ozone.series[0].points[0], 'Ozone');

			if(particules)
				xhr.getLastValueFor(particules.series[0].points[0], 'Particules Fines');
		}, 2000);
	</script>
</aside>
